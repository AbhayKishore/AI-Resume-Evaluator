<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Resume Analyzer</title>

    <!-- Bootstrap & font -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: radial-gradient(circle at top, #f3f4ff 0, #e9edf7 45%, #dde3f0 100%);
            min-height: 100vh;
        }
        .card-resume {
            border: none;
            border-radius: 1rem;
            box-shadow: 0 8px 24px rgba(15, 23, 42, 0.12);
        }
        .upload-area {
            border: 2px dashed #6c63ff;
            border-radius: 0.75rem;
            padding: 1.75rem;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.2s ease, border-color 0.2s ease;
        }
        .upload-area:hover,
        .upload-area:focus {
            background-color: #f5f5ff;
            border-color: #574bfa;
        }
        .btn-analyze {
            background-color: #6c63ff;
            border: none;
        }
        .btn-analyze:hover:not(:disabled) {
            background-color: #574bfa;
        }
        .error-message {
            color: #dc3545;
            text-align: center;
            margin-top: 0.75rem;
        }
        @media (max-width: 576px) {
            .card-resume {
                border-radius: 0.75rem;
            }
        }
        .upload-area.dragover {
  background-color: #f5f7ff;
  border-color: #3b82f6;
  box-shadow: 0 4px 18px rgba(59,130,246,0.08);
}

    </style>
</head>

<body class="d-flex align-items-center justify-content-center py-4">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-7 col-md-9">
                <div class="card card-resume">
                    <div class="card-body p-4 p-md-5">

                        <h3 id="mainHeading" class="text-center mb-2 fw-semibold">AI Resume Analyzer</h3>
                        <p class="text-muted text-center mb-4">
                            Upload your <strong>PDF</strong> or <strong>DOCX</strong> resume to receive instant insights
                            on extraction quality, ATS compatibility, soft skills, and timeline consistency.
                        </p>

                        <!-- Resume Upload Form -->
                        <form id="resumeForm"
                              action="{{ url_for('analyze') }}"
                              method="POST"
                              enctype="multipart/form-data"
                              novalidate>

                            <!-- Upload area -->
                            <div class="mb-3">
                                <div
                                    class="upload-area"
                                    id="uploadArea"
                                    role="button"
                                    tabindex="0"
                                    aria-label="Upload resume (PDF or DOCX). Click or press Enter to open file picker."
                                    onclick="document.getElementById('resume').click()">

                                    <input type="file"
                                           id="resume"
                                           name="resume"
                                           accept=".pdf,.docx"
                                           class="d-none"
                                           required
                                           aria-required="true" />

                                    <p id="fileLabel" class="text-secondary mb-1">
                                        ðŸ“„ Click to upload your resume
                                    </p>
                                    <p class="text-muted small mb-0">
                                        Accepted: .pdf, .docx â€” max 32&nbsp;MB
                                    </p>
                                </div>
                            </div>

                            <!-- Job description -->
                            <div class="mb-3">
                                <label for="job_text" class="form-label fw-semibold mb-1">
                                    Desired Job Description <span class="text-muted small">(optional)</span>
                                </label>
                                <textarea class="form-control"
                                          id="job_text"
                                          name="job_text"
                                          rows="4"
                                          placeholder="Paste the job advert or a short role description to obtain tailored ATS and skill suggestions."></textarea>
                            </div>

                            <!-- Submit button with spinner -->
                            <button type="submit"
                                    class="btn btn-analyze w-100 py-2 d-flex justify-content-center align-items-center gap-2"
                                    id="submitBtn"
                                    aria-live="polite">

                                <span id="submitText">Analyze Resume</span>
                                <div id="spinner"
                                     class="spinner-border spinner-border-sm d-none"
                                     role="status"
                                     aria-hidden="true"></div>
                            </button>
                        </form>

                        {% if error %}
                        <p class="error-message" role="alert">{{ error }}</p>
                        {% endif %}

                        <p class="text-center text-muted small mt-4 mb-0">
                            By using this tool you confirm that you will not upload sensitive medical records
                            or classified documents. Data is processed on the server and may be temporarily
                            stored in the session for your convenience.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
  (function() {
    const MAX_BYTES = 32 * 1024 * 1024; // keep in sync with app.config['MAX_CONTENT_LENGTH']
    const resumeInput = document.getElementById('resume');
    const fileLabel   = document.getElementById('fileLabel');
    const uploadArea  = document.getElementById('uploadArea');
    const form        = document.getElementById('resumeForm');
    const submitBtn   = document.getElementById('submitBtn');
    const submitText  = document.getElementById('submitText');
    const spinner     = document.getElementById('spinner');

    // Utility: format bytes
    function formatBytes(bytes) {
      if (bytes === 0) return '0 B';
      const k = 1024, dm = 1;
      const sizes = ['B','KB','MB','GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
    }

    // Update UI to show selected filename (sanitized)
    function showFileName(file) {
      if (!file) {
        fileLabel.textContent = 'ðŸ“„ Click to upload your resume';
        return;
      }
      const sizeText = file.size ? ` â€” ${formatBytes(file.size)}` : '';
      // keep displayed name short if long
      let name = file.name;
      if (name.length > 48) name = name.slice(0, 28) + 'â€¦' + name.slice(-16);
      fileLabel.textContent = `${name}${sizeText}`;
      fileLabel.style.color = '';
    }

    // Basic client-side validation: type & size
    function validateFile(file) {
      if (!file) return { ok: false, reason: 'No file selected.' };
      const allowed = ['application/pdf', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];
      // Chrome/Firefox may give Word as different mime types - fallback to extension check:
      const ext = (file.name || '').split('.').pop().toLowerCase();
      const extAllowed = ['pdf','docx'];

      if (file.size > MAX_BYTES) {
        return { ok: false, reason: `File too large (max ${formatBytes(MAX_BYTES)}).` };
      }

      if (allowed.indexOf(file.type) === -1 && extAllowed.indexOf(ext) === -1) {
        return { ok: false, reason: 'Unsupported file type. Please upload a PDF or DOCX.' };
      }
      return { ok: true };
    }

    // Show selected filename when user picks file
    resumeInput.addEventListener('change', () => {
      const file = resumeInput.files && resumeInput.files[0];
      showFileName(file);
      // immediate validation feedback
      if (file) {
        const v = validateFile(file);
        if (!v.ok) {
          fileLabel.textContent = v.reason;
          fileLabel.style.color = '#dc3545';
        }
      }
    });

    // Keyboard accessibility for upload area (space/enter)
    uploadArea.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        resumeInput.click();
      }
    });

    // Drag & drop support
    uploadArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadArea.classList.add('dragover');
    });
    uploadArea.addEventListener('dragleave', (e) => {
      uploadArea.classList.remove('dragover');
    });
    uploadArea.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadArea.classList.remove('dragover');
      const dropped = e.dataTransfer && e.dataTransfer.files && e.dataTransfer.files[0];
      if (dropped) {
        // Populate the hidden file input (works in most browsers)
        resumeInput.files = e.dataTransfer.files;
        const evt = new Event('change', { bubbles: true });
        resumeInput.dispatchEvent(evt);
      }
    });

    // Prevent double submit & validate file before sending
    let submitting = false;
    form.addEventListener('submit', (e) => {
      if (submitting) {
        e.preventDefault();
        return;
      }

      const file = resumeInput.files && resumeInput.files[0];
      const validated = validateFile(file);
      if (!validated.ok) {
        e.preventDefault();
        fileLabel.textContent = validated.reason;
        fileLabel.style.color = '#dc3545';
        resumeInput.focus();
        return;
      }

      // Visual loading state
      spinner.classList.remove('d-none');
      submitText.textContent = 'Analyzingâ€¦';
      submitBtn.disabled = true;
      submitBtn.setAttribute('aria-busy', 'true');
      submitting = true;

      // In case form submission fails client-side (rare), restore button after 20s
      setTimeout(() => {
        if (submitting) {
          submitting = false;
          spinner.classList.add('d-none');
          submitText.textContent = 'Analyze Resume';
          submitBtn.disabled = false;
          submitBtn.removeAttribute('aria-busy');
        }
      }, 20000);
    });

    // Initialize label
    try {
      showFileName(resumeInput.files && resumeInput.files[0]);
    } catch (e) {}
  })();
</script>
</body>
</html>
